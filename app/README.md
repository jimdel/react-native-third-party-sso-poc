# Apple Sign In

Library: https://github.com/invertase/react-native-apple-authentication

## Pre-requisites

Follow steps in [here](https://github.com/invertase/react-native-apple-authentication/blob/main/docs/INITIAL_SETUP.md) to setup the Apple config.

## First Login

```json
{
  "authorizationCode": "ce26b26bd36c84b78ac288ce394665983.0.rruzu.lW4hKuQ_JjeZi_84rYr74Q",
  "authorizedScopes": [],
  "email": "user@gmail.com",
  "fullName": {
    "familyName": "Schrute",
    "givenName": "Dwight",
    "middleName": null,
    "namePrefix": null,
    "nameSuffix": null,
    "nickname": null
  },
  "identityToken": "eyJraWQiOiJZdXlYb1kiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJodHRwczovL2FwcGxlaWQuYXBwbGUuY29tIiwiYXVkIjoiY29tLmdsb2NhbC50ZXN0LmFwcGxlU2lnbkluIiwiZXhwIjoxNzA0NDA2NTA5LCJpYXQiOjE3MDQzMjAxMDksInN1YiI6IjAwMTQ5NC45NDQ0MzExZDI3NTU0ZGM3YWY2MWM2NDM3YjYyYjBkZS4yMjE1Iiwibm9uY2UiOiJjZTcxMThkMTBmZmQ0NDUyY2Y0MDE5YzQ5MTQ1MWVlYTYzMGU0YWMwMmZkNDI0MDlmZDg3ZjcyZmFkMTc4Y2NhIiwiY19oYXNoIjoiNWdYa0RrVU81R0xzdktiandxbVMwdyIsImVtYWlsIjoiamRlbGF5LmpyQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjoidHJ1ZSIsImF1dGhfdGltZSI6MTcwNDMyMDEwOSwibm9uY2Vfc3VwcG9ydGVkIjp0cnVlLCJyZWFsX3VzZXJfc3RhdHVzIjoyfQ.GMQ2gBvnb7vDBTVbYfShJHiO0FoXArLrlrpMVbeMiG4SycsN2m5xzRRFRfa0c9G_CF6xuv7Hq_7EbPUhqpghc9EloQ4qI9-8toGa-pknwVcq4Oc6W26ArL8qTFjqodTWfOfQ3jUdOixQeu-x30qwbxSqSPD5pE8Eq8ZuodrpFvWmXIY-JytCP775d3ltB8v2VU1Rl_9LK6_9ZLF0zEI5wgKWRfOsDpZv1ynPXZrDP4Kc8jXN6psTOs-KSTr4lKfRYukFKTK4UgpTIfzBTDOqvZA4NzPZKlAf28VLTjwMHM2jMug9vcVIt9T2wpgpzfsuVcQJW43cS4GvEgBezDM1aQ",
  "nonce": "4DBQ0zw3l301oriGwEmjKV6En1FvzBut",
  "realUserStatus": 2,
  "state": null,
  "user": "001494.9444311d27554dc7af61c6437b62b0de.2215"
}
```

## Subsequent Logins

```json
{
  "authorizationCode": "c504ab9ee1f844514a24ffc5b3c4dedd9.0.rruzu.-Hv5LtbQ_oQK9vD1pg3S-Q",
  "authorizedScopes": [],
  "email": null,
  "fullName": {
    "familyName": null,
    "givenName": null,
    "middleName": null,
    "namePrefix": null,
    "nameSuffix": null,
    "nickname": null
  },
  "identityToken": "eyJraWQiOiJsVkhkT3g4bHRSIiwiYWxnIjoiUlMyNTYifQ.eyJpc3MiOiJodHRwczovL2FwcGxlaWQuYXBwbGUuY29tIiwiYXVkIjoiY29tLmdsb2NhbC50ZXN0LmFwcGxlU2lnbkluIiwiZXhwIjoxNzA0NDA2NTMxLCJpYXQiOjE3MDQzMjAxMzEsInN1YiI6IjAwMTQ5NC45NDQ0MzExZDI3NTU0ZGM3YWY2MWM2NDM3YjYyYjBkZS4yMjE1Iiwibm9uY2UiOiI0OTAxMDcwZDVjZGIzZmYwYTA0YjUxNmE0ZDc5OTkzYWUwZWJkNDk1ODE2M2ZlYzMzMGE3N2RiNjk0OWY4OTNkIiwiY19oYXNoIjoiNVBUYk1XMDZLNzN6N1RWdXhVMzRJQSIsImVtYWlsIjoiamRlbGF5LmpyQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjoidHJ1ZSIsImF1dGhfdGltZSI6MTcwNDMyMDEzMSwibm9uY2Vfc3VwcG9ydGVkIjp0cnVlfQ.M_kdDdipVe3Vn288wdTjZWrhZB6-EG5SfFKHchUracNZ4C1U3ABpT8G9RqD9_63C2F7ARRNKCy0EQt1C1Q3kwMfFhZ01HNd9esC2DkNNguiMkxClOH8ZzwJ5_hEmI93frSSzKw5E_DTRpTQHv3xH46fQlj0fpEa2jz3qkD0-d0ixLelFMOISHs-yifBa9Z_riXuFSJwg3ILpAZWlOUkbaNL6Dwsm2sCIYwC6USGlUMc1TJyaFxqhDJxQIvucVw4IPmNjsw8xXSfYK4GWRUeLpjrZFhphjttZZrOhdx1LK2xRYia-3u91Y2HCCKxQDjrz8kiVTEViuTa1vuFHw7kkBA",
  "nonce": "QCRLthXND_uei3IhVFpqTMplpyeque_l",
  "realUserStatus": 1,
  "state": null,
  "user": "001494.9444311d27554dc7af61c6437b62b0de.2215"
}
```

### Notes

- `nonce`

  - A `nonce` is a random or unique number that is used only once in a cryptographic communication.
  - In the context of Sign In with Apple, a `nonce` is generated by your app and included in the authentication request.
  - The `nonce` is returned in the authentication response and is used to verify the integrity and authenticity of the communication.
  - The purpose of the `nonce` is to prevent replay attacks, where an attacker intercepts and reuses a valid authentication response.

- `identityToken`

  - The `identityToken` is a JSON Web Token (JWT) that contains information about the authenticated user.
  - It includes details such as the user's unique identifier (user_id), email, and other relevant information.
  - The `identityToken` is signed by Apple's servers, and your app should verify the signature using Apple's public key to ensure its authenticity.
  - It provides a secure way for your app to obtain user information after a successful authentication.

- Here's a simplified flow of how these components work together in the Sign In with Apple process:

1. Your app initiates the authentication process by sending a request to Apple with a nonce.
2. Apple's authentication server processes the request and returns an authentication response.
3. The response includes an `identityToken`, among other things.
4. Your app verifies the `identityToken`'s signature using Apple's public key and checks the nonce to ensure it matches the one originally sent.
5. If verification is successful, your app can trust the information in the `identityToken` and proceed with user authentication.

- After first login we will have to parse the `identityToken` for name & email.
